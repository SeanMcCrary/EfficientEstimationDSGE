function par = nk_log_tp_coef(z,d,m,x,par)

% Policy function parameters
x  = x(:);
a0 = x(1); a1 = x(2); a2 = x(3); a3 = x(4);  % Inflation
b0 = x(5); b1 = x(6); b2 = x(7); b3 = x(8);  % Labor

% Model parameters
% PE(kp,n,t,b0,b1,b2,b3,z,d,m,a0,a1,a2,a3,rd,rm,rz,df,sz,sd,sm)
% EE(rd,sd,d,rz,sz,z,rm,sm,m,t,a0,a1,a2,a3,b0,b1,b2,b3,tp,ty)
rz    = par.rhoz;
sz    = par.sigez;
rd    = par.rhod;
sd    = par.siged;
rm    = par.rhom;
sm    = par.sigem;
ty    = par.phiy;
tp    = par.phipi;
t     = par.tau;
n     = par.eta;
df    = exp(par.piss-par.Rss);
kp    = (1-par.gamma)/(exp(2*par.piss)*par.phip*par.gamma); % Log-linear Philips Curve Term

%-------------------------------------------------------------------------%
%  Residuals: 8 equations in 8 unknowns
F = zeros(8,1);

% Euler equation
F(1) = m - a0 + tp*(a0 + a2*d + a3*m + a1*z) - t*(b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + (sd^2*(a2 + b2*t - 1)^2)/2 + d*(rd - 1) + ty*(b0 + z + b2*d + b3*m + b1*z) + (sz^2*(a1 + t*(b1 + 1))^2)/2 - t*z*(rz - 1) + (sm^2*t^2*(a3 + b3)^2)/2 - a2*d*rd - a3*m*rm - a1*rz*z;

% Euler equation: dz
F(2) = a1*tp - a1*rz + ty*(b1 + 1) - t*(rz - 1) - b1*t*(rz - 1);

% Euler equation: dd
F(3) = rd - a2*rd + a2*tp + b2*ty - b2*t*(rd - 1) - 1;

% Euler equation: dm
F(4) = a3*tp - a3*rm + b3*ty - b3*t*(rm - 1) + 1;

% Pricing equation
F(5) = exp(a0 + a2*d + a3*m + a1*z) - exp(2*a0 + 2*a2*d + 2*a3*m + 2*a1*z) + kp*(exp(z*(t - 1) + (n + t)*(b0 + b2*d + b3*m + b1*z)) - 1) - df*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z) + df*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2);

% Pricing equation: dz
F(6) = a1*exp(a0 + a2*d + a3*m + a1*z) - 2*a1*exp(2*a0 + 2*a2*d + 2*a3*m + 2*a1*z) + kp*exp(z*(t - 1) + (n + t)*(b0 + b2*d + b3*m + b1*z))*(t + b1*(n + t) - 1) - df*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(a1*rz - (t - 1)*(rz + b1*(rz - 1) - 1)) + df*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(2*a1*rz - (t - 1)*(rz + b1*(rz - 1) - 1));

% pricing equation: dd
F(7) = a2*exp(a0 + a2*d + a3*m + a1*z) - 2*a2*exp(2*a0 + 2*a2*d + 2*a3*m + 2*a1*z) + df*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(rd + 2*a2*rd - b2*(rd - 1)*(t - 1) - 1) - df*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(rd + a2*rd - b2*(rd - 1)*(t - 1) - 1) + b2*kp*exp(z*(t - 1) + (n + t)*(b0 + b2*d + b3*m + b1*z))*(n + t);

% pricing equation: dm
F(8) = a3*exp(a0 + a2*d + a3*m + a1*z) - 2*a3*exp(2*a0 + 2*a2*d + 2*a3*m + 2*a1*z) - df*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(a3*rm - b3*(rm - 1)*(t - 1)) + df*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(2*a3*rm - b3*(rm - 1)*(t - 1)) + b3*kp*exp(z*(t - 1) + (n + t)*(b0 + b2*d + b3*m + b1*z))*(n + t);

%----------------------------------------------------------------------------------------------------------------
%   Jacobian
J = zeros(8,8);

% Euler
J(1,1) = tp-1;
J(1,2) = (a1 + t*(b1 + 1))*sz^2 - rz*z + tp*z;
J(1,3) = (a2 + b2*t - 1)*sd^2   - d*rd + d*tp;
J(1,4) = (a3 + b3)*sm^2*t^2 - m*rm + m*tp;
J(1,5) = ty;
J(1,6) = t*(a1 + t*(b1 + 1))*sz^2 + ty*z - t*z*(rz - 1);
J(1,7) = t*(a2 + b2*t - 1)*sd^2 + d*ty - d*t*(rd - 1);
J(1,8) = (a3 + b3)*sm^2*t^2 - m*(rm - 1)*t + m*ty;

% Euler: dz
%J(2,1) = 0;
J(2,2) = tp-rz;
%J(2,3) = 0;
%J(2,4) = 0;
%J(2,5) = 0;
J(2,6) = ty - t*(rz - 1);
%J(2,7) = 0;
%J(2,8) = 0;

% Euler: dd
%J(3,1) = 0;
%J(3,2) = 0;
J(3,3) = tp-rd;
%J(3,4) = 0;
%J(3,5) = 0;
%J(3,6) = 0;
J(3,7) = ty - t*(rd - 1);
%J(3,8) = 0;

% Euler: dm
%J(4,1) = 0;
%J(4,2) = 0;
%J(4,3) = 0;
J(4,4) = tp-rm;
%J(4,5) = 0;
%J(4,6) = 0;
%J(4,7) = 0;
J(4,8) = ty - t*(rm - 1);

% Price
J(5,1) = exp(a0 + a2*d + a3*m + a1*z) - 2*exp(2*a0 + 2*a2*d + 2*a3*m + 2*a1*z) - df*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z) + 2*df*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2);
J(5,2) = z*exp(a0 + a2*d + a3*m + a1*z) - 2*z*exp(2*a0 + 2*a2*d + 2*a3*m + 2*a1*z) - (df*sz^2*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(2*a1 - 2*(b1 + 1)*(t - 1)))/2 - df*rz*z*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z) + (df*sz^2*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(8*a1 - 4*(b1 + 1)*(t - 1)))/2 + 2*df*rz*z*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2);
J(5,3) = d*exp(a0 + a2*d + a3*m + a1*z) - 2*d*exp(2*a0 + 2*a2*d + 2*a3*m + 2*a1*z) + (df*sd^2*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(8*a2 - 4*b2*(t - 1) + 4))/2 + 2*d*df*rd*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2) - (df*sd^2*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(2*a2 - 2*b2*(t - 1) + 2))/2 - d*df*rd*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z);
J(5,4) = m*exp(a0 + a2*d + a3*m + a1*z) - 2*m*exp(2*a0 + 2*a2*d + 2*a3*m + 2*a1*z) + df*sm^2*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2) - (df*sm^2*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z))/2 + 2*df*m*rm*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2) - df*m*rm*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z);
J(5,5) = kp*exp(z*(t - 1) + (n + t)*(b0 + b2*d + b3*m + b1*z))*(n + t);
J(5,6) = kp*z*exp(z*(t - 1) + (n + t)*(b0 + b2*d + b3*m + b1*z))*(n + t) + df*z*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(rz - 1)*(t - 1) - df*sz^2*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(2*a1 - (b1 + 1)*(t - 1))*(t - 1) + df*sz^2*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(a1 - (b1 + 1)*(t - 1))*(t - 1) - df*z*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(rz - 1)*(t - 1);
J(5,7) = d*kp*exp(z*(t - 1) + (n + t)*(b0 + b2*d + b3*m + b1*z))*(n + t) + df*sd^2*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(t - 1)*(a2 - b2*(t - 1) + 1) + d*df*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(rd - 1)*(t - 1) - d*df*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(rd - 1)*(t - 1) - df*sd^2*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(t - 1)*(2*a2 - b2*(t - 1) + 1);
J(5,8) = kp*m*exp(z*(t - 1) + (n + t)*(b0 + b2*d + b3*m + b1*z))*(n + t) - (df*sm^2*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(t - 1))/2 + (df*sm^2*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(t - 1))/2 + df*m*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(rm - 1)*(t - 1) - df*m*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(rm - 1)*(t - 1);

% Price: dz
J(6,1) = a1*exp(a0 + a2*d + a3*m + a1*z) - 4*a1*exp(2*a0 + 2*a2*d + 2*a3*m + 2*a1*z) - df*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(a1*rz - (t - 1)*(rz + b1*(rz - 1) - 1)) + 2*df*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(2*a1*rz - (t - 1)*(rz + b1*(rz - 1) - 1));
J(6,2) = exp(a0 + a2*d + a3*m + a1*z) - 2*exp(2*a0 + 2*a2*d + 2*a3*m + 2*a1*z) - 4*a1*z*exp(2*a0 + 2*a2*d + 2*a3*m + 2*a1*z) + a1*z*exp(a0 + a2*d + a3*m + a1*z) + 2*df*rz*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2) - df*rz*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z) - (df*sz^2*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(2*a1 - 2*(b1 + 1)*(t - 1))*(a1*rz - (t - 1)*(rz + b1*(rz - 1) - 1)))/2 - df*rz*z*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(a1*rz - (t - 1)*(rz + b1*(rz - 1) - 1)) + (df*sz^2*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(8*a1 - 4*(b1 + 1)*(t - 1))*(2*a1*rz - (t - 1)*(rz + b1*(rz - 1) - 1)))/2 + 2*df*rz*z*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(2*a1*rz - (t - 1)*(rz + b1*(rz - 1) - 1));
J(6,3) = a1*d*exp(a0 + a2*d + a3*m + a1*z) - 4*a1*d*exp(2*a0 + 2*a2*d + 2*a3*m + 2*a1*z) - d*df*rd*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(a1*rz - (t - 1)*(rz + b1*(rz - 1) - 1)) + (df*sd^2*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(2*a1*rz - (t - 1)*(rz + b1*(rz - 1) - 1))*(8*a2 - 4*b2*(t - 1) + 4))/2 + 2*d*df*rd*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(2*a1*rz - (t - 1)*(rz + b1*(rz - 1) - 1)) - (df*sd^2*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(a1*rz - (t - 1)*(rz + b1*(rz - 1) - 1))*(2*a2 - 2*b2*(t - 1) + 2))/2;
J(6,4) = a1*m*exp(a0 + a2*d + a3*m + a1*z) - 4*a1*m*exp(2*a0 + 2*a2*d + 2*a3*m + 2*a1*z) - (df*sm^2*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(a1*rz - (t - 1)*(rz + b1*(rz - 1) - 1)))/2 + df*sm^2*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(2*a1*rz - (t - 1)*(rz + b1*(rz - 1) - 1)) - df*m*rm*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(a1*rz - (t - 1)*(rz + b1*(rz - 1) - 1)) + 2*df*m*rm*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(2*a1*rz - (t - 1)*(rz + b1*(rz - 1) - 1));
J(6,5) = kp*exp(z*(t - 1) + (n + t)*(b0 + b2*d + b3*m + b1*z))*(n + t)*(t + b1*(n + t) - 1);
J(6,6) = kp*exp(z*(t - 1) + (n + t)*(b0 + b2*d + b3*m + b1*z))*(n + t) - df*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(rz - 1)*(t - 1) + kp*z*exp(z*(t - 1) + (n + t)*(b0 + b2*d + b3*m + b1*z))*(n + t)*(t + b1*(n + t) - 1) + df*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(rz - 1)*(t - 1) + df*z*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(a1*rz - (t - 1)*(rz + b1*(rz - 1) - 1))*(rz - 1)*(t - 1) - df*sz^2*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(2*a1 - (b1 + 1)*(t - 1))*(2*a1*rz - (t - 1)*(rz + b1*(rz - 1) - 1))*(t - 1) + df*sz^2*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(a1*rz - (t - 1)*(rz + b1*(rz - 1) - 1))*(a1 - (b1 + 1)*(t - 1))*(t - 1) - df*z*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(2*a1*rz - (t - 1)*(rz + b1*(rz - 1) - 1))*(rz - 1)*(t - 1);
J(6,7) = d*kp*exp(z*(t - 1) + (n + t)*(b0 + b2*d + b3*m + b1*z))*(n + t)*(t + b1*(n + t) - 1) - df*sd^2*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(2*a1*rz - (t - 1)*(rz + b1*(rz - 1) - 1))*(t - 1)*(2*a2 - b2*(t - 1) + 1) + df*sd^2*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(a1*rz - (t - 1)*(rz + b1*(rz - 1) - 1))*(t - 1)*(a2 - b2*(t - 1) + 1) + d*df*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(a1*rz - (t - 1)*(rz + b1*(rz - 1) - 1))*(rd - 1)*(t - 1) - d*df*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(2*a1*rz - (t - 1)*(rz + b1*(rz - 1) - 1))*(rd - 1)*(t - 1);
J(6,8) = kp*m*exp(z*(t - 1) + (n + t)*(b0 + b2*d + b3*m + b1*z))*(n + t)*(t + b1*(n + t) - 1) - (df*sm^2*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(2*a1*rz - (t - 1)*(rz + b1*(rz - 1) - 1))*(t - 1))/2 + (df*sm^2*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(a1*rz - (t - 1)*(rz + b1*(rz - 1) - 1))*(t - 1))/2 + df*m*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(a1*rz - (t - 1)*(rz + b1*(rz - 1) - 1))*(rm - 1)*(t - 1) - df*m*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(2*a1*rz - (t - 1)*(rz + b1*(rz - 1) - 1))*(rm - 1)*(t - 1);

% Price: dd
J(7,1) = a2*exp(a0 + a2*d + a3*m + a1*z) - 4*a2*exp(2*a0 + 2*a2*d + 2*a3*m + 2*a1*z) + 2*df*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(rd + 2*a2*rd - b2*(rd - 1)*(t - 1) - 1) - df*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(rd + a2*rd - b2*(rd - 1)*(t - 1) - 1);
J(7,2) = a2*z*exp(a0 + a2*d + a3*m + a1*z) - 4*a2*z*exp(2*a0 + 2*a2*d + 2*a3*m + 2*a1*z) - (df*sz^2*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(2*a1 - 2*(b1 + 1)*(t - 1))*(rd + a2*rd - b2*(rd - 1)*(t - 1) - 1))/2 - df*rz*z*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(rd + a2*rd - b2*(rd - 1)*(t - 1) - 1) + (df*sz^2*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(8*a1 - 4*(b1 + 1)*(t - 1))*(rd + 2*a2*rd - b2*(rd - 1)*(t - 1) - 1))/2 + 2*df*rz*z*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(rd + 2*a2*rd - b2*(rd - 1)*(t - 1) - 1);
J(7,3) = exp(a0 + a2*d + a3*m + a1*z) - 2*exp(2*a0 + 2*a2*d + 2*a3*m + 2*a1*z) - 4*a2*d*exp(2*a0 + 2*a2*d + 2*a3*m + 2*a1*z) + a2*d*exp(a0 + a2*d + a3*m + a1*z) + 2*df*rd*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2) - df*rd*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z) - (df*sd^2*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(2*a2 - 2*b2*(t - 1) + 2)*(rd + a2*rd - b2*(rd - 1)*(t - 1) - 1))/2 - d*df*rd*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(rd + a2*rd - b2*(rd - 1)*(t - 1) - 1) + (df*sd^2*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(8*a2 - 4*b2*(t - 1) + 4)*(rd + 2*a2*rd - b2*(rd - 1)*(t - 1) - 1))/2 + 2*d*df*rd*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(rd + 2*a2*rd - b2*(rd - 1)*(t - 1) - 1);
J(7,4) = a2*m*exp(a0 + a2*d + a3*m + a1*z) - 4*a2*m*exp(2*a0 + 2*a2*d + 2*a3*m + 2*a1*z) - (df*sm^2*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(rd + a2*rd - b2*(rd - 1)*(t - 1) - 1))/2 + df*sm^2*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(rd + 2*a2*rd - b2*(rd - 1)*(t - 1) - 1) - df*m*rm*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(rd + a2*rd - b2*(rd - 1)*(t - 1) - 1) + 2*df*m*rm*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(rd + 2*a2*rd - b2*(rd - 1)*(t - 1) - 1);
J(7,5) = b2*kp*exp(z*(t - 1) + (n + t)*(b0 + b2*d + b3*m + b1*z))*(n + t)^2;
J(7,6) = b2*kp*z*exp(z*(t - 1) + (n + t)*(b0 + b2*d + b3*m + b1*z))*(n + t)^2 - df*z*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(rz - 1)*(t - 1)*(rd + 2*a2*rd - b2*(rd - 1)*(t - 1) - 1) + df*z*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(rz - 1)*(t - 1)*(rd + a2*rd - b2*(rd - 1)*(t - 1) - 1) - df*sz^2*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(2*a1 - (b1 + 1)*(t - 1))*(t - 1)*(rd + 2*a2*rd - b2*(rd - 1)*(t - 1) - 1) + df*sz^2*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(a1 - (b1 + 1)*(t - 1))*(t - 1)*(rd + a2*rd - b2*(rd - 1)*(t - 1) - 1);
J(7,7) = kp*exp(z*(t - 1) + (n + t)*(b0 + b2*d + b3*m + b1*z))*(n + t) - df*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(rd - 1)*(t - 1) + b2*d*kp*exp(z*(t - 1) + (n + t)*(b0 + b2*d + b3*m + b1*z))*(n + t)^2 + df*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(rd - 1)*(t - 1) - d*df*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(rd - 1)*(t - 1)*(rd + 2*a2*rd - b2*(rd - 1)*(t - 1) - 1) - df*sd^2*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(t - 1)*(2*a2 - b2*(t - 1) + 1)*(rd + 2*a2*rd - b2*(rd - 1)*(t - 1) - 1) + df*sd^2*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(t - 1)*(a2 - b2*(t - 1) + 1)*(rd + a2*rd - b2*(rd - 1)*(t - 1) - 1) + d*df*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(rd - 1)*(t - 1)*(rd + a2*rd - b2*(rd - 1)*(t - 1) - 1);
J(7,8) = b2*kp*m*exp(z*(t - 1) + (n + t)*(b0 + b2*d + b3*m + b1*z))*(n + t)^2 + (df*sm^2*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(t - 1)*(rd + a2*rd - b2*(rd - 1)*(t - 1) - 1))/2 - (df*sm^2*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(t - 1)*(rd + 2*a2*rd - b2*(rd - 1)*(t - 1) - 1))/2 - df*m*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(rm - 1)*(t - 1)*(rd + 2*a2*rd - b2*(rd - 1)*(t - 1) - 1) + df*m*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(rm - 1)*(t - 1)*(rd + a2*rd - b2*(rd - 1)*(t - 1) - 1);

% Price: dm
J(8,1) = a3*exp(a0 + a2*d + a3*m + a1*z) - 4*a3*exp(2*a0 + 2*a2*d + 2*a3*m + 2*a1*z) - df*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(a3*rm - b3*(rm - 1)*(t - 1)) + 2*df*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(2*a3*rm - b3*(rm - 1)*(t - 1));
J(8,2) = a3*z*exp(a0 + a2*d + a3*m + a1*z) - 4*a3*z*exp(2*a0 + 2*a2*d + 2*a3*m + 2*a1*z) - df*rz*z*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(a3*rm - b3*(rm - 1)*(t - 1)) + (df*sz^2*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(8*a1 - 4*(b1 + 1)*(t - 1))*(2*a3*rm - b3*(rm - 1)*(t - 1)))/2 + 2*df*rz*z*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(2*a3*rm - b3*(rm - 1)*(t - 1)) - (df*sz^2*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(2*a1 - 2*(b1 + 1)*(t - 1))*(a3*rm - b3*(rm - 1)*(t - 1)))/2;
J(8,3) = a3*d*exp(a0 + a2*d + a3*m + a1*z) - 4*a3*d*exp(2*a0 + 2*a2*d + 2*a3*m + 2*a1*z) + (df*sd^2*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(2*a3*rm - b3*(rm - 1)*(t - 1))*(8*a2 - 4*b2*(t - 1) + 4))/2 + 2*d*df*rd*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(2*a3*rm - b3*(rm - 1)*(t - 1)) - (df*sd^2*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(a3*rm - b3*(rm - 1)*(t - 1))*(2*a2 - 2*b2*(t - 1) + 2))/2 - d*df*rd*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(a3*rm - b3*(rm - 1)*(t - 1));
J(8,4) = exp(a0 + a2*d + a3*m + a1*z) - 2*exp(2*a0 + 2*a2*d + 2*a3*m + 2*a1*z) - 4*a3*m*exp(2*a0 + 2*a2*d + 2*a3*m + 2*a1*z) + a3*m*exp(a0 + a2*d + a3*m + a1*z) + 2*df*rm*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2) - df*rm*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z) + df*sm^2*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(2*a3*rm - b3*(rm - 1)*(t - 1)) - (df*sm^2*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(a3*rm - b3*(rm - 1)*(t - 1)))/2 + 2*df*m*rm*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(2*a3*rm - b3*(rm - 1)*(t - 1)) - df*m*rm*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(a3*rm - b3*(rm - 1)*(t - 1));
J(8,5) = b3*kp*exp(z*(t - 1) + (n + t)*(b0 + b2*d + b3*m + b1*z))*(n + t)^2;
J(8,6) = b3*kp*z*exp(z*(t - 1) + (n + t)*(b0 + b2*d + b3*m + b1*z))*(n + t)^2 + df*z*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(rz - 1)*(t - 1)*(a3*rm - b3*(rm - 1)*(t - 1)) - df*sz^2*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(2*a1 - (b1 + 1)*(t - 1))*(t - 1)*(2*a3*rm - b3*(rm - 1)*(t - 1)) + df*sz^2*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(a1 - (b1 + 1)*(t - 1))*(t - 1)*(a3*rm - b3*(rm - 1)*(t - 1)) - df*z*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(rz - 1)*(t - 1)*(2*a3*rm - b3*(rm - 1)*(t - 1));
J(8,7) = b3*d*kp*exp(z*(t - 1) + (n + t)*(b0 + b2*d + b3*m + b1*z))*(n + t)^2 + df*sd^2*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(t - 1)*(a3*rm - b3*(rm - 1)*(t - 1))*(a2 - b2*(t - 1) + 1) + d*df*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(rd - 1)*(t - 1)*(a3*rm - b3*(rm - 1)*(t - 1)) - d*df*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(rd - 1)*(t - 1)*(2*a3*rm - b3*(rm - 1)*(t - 1)) - df*sd^2*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(t - 1)*(2*a3*rm - b3*(rm - 1)*(t - 1))*(2*a2 - b2*(t - 1) + 1);
J(8,8) = kp*exp(z*(t - 1) + (n + t)*(b0 + b2*d + b3*m + b1*z))*(n + t) - df*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(rm - 1)*(t - 1) + b3*kp*m*exp(z*(t - 1) + (n + t)*(b0 + b2*d + b3*m + b1*z))*(n + t)^2 + df*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(rm - 1)*(t - 1) - (df*sm^2*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(t - 1)*(2*a3*rm - b3*(rm - 1)*(t - 1)))/2 + (df*sm^2*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(t - 1)*(a3*rm - b3*(rm - 1)*(t - 1)))/2 + df*m*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(rm - 1)*(t - 1)*(a3*rm - b3*(rm - 1)*(t - 1)) - df*m*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(rm - 1)*(t - 1)*(2*a3*rm - b3*(rm - 1)*(t - 1));

%---------------------------------------------------------------------------------------------------
% Newton solver
tol1    = 1;
tol2    = 1;
maxiter = 100;
crit    = 1e-8;
tol     = max(tol1,tol2);
B       = x;
count   = 0;

while tol > crit && count<=maxiter

    % Newton solver
    Bp = B - J\F;

    % check convergence
    count = count +1;
    tol1  = norm(F);
    tol2  = norm(abs(Bp-B));
    tol   = max(tol1,tol2);

    % update coefficients
    B  = Bp;
    a0 = B(1); a1 = B(2); a2 = B(3); a3 = B(4);  % Inflation
    b0 = B(5); b1 = B(6); b2 = B(7); b3 = B(8);  % Labor

    %-----------------------------------------------------------------------------
    % update residuals

    % Euler equation
    F(1) = m - a0 + tp*(a0 + a2*d + a3*m + a1*z) - t*(b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + (sd^2*(a2 + b2*t - 1)^2)/2 + d*(rd - 1) + ty*(b0 + z + b2*d + b3*m + b1*z) + (sz^2*(a1 + t*(b1 + 1))^2)/2 - t*z*(rz - 1) + (sm^2*t^2*(a3 + b3)^2)/2 - a2*d*rd - a3*m*rm - a1*rz*z;

    % Euler equation: dz
    F(2) = a1*tp - a1*rz + ty*(b1 + 1) - t*(rz - 1) - b1*t*(rz - 1);

    % Euler equation: dd
    F(3) = rd - a2*rd + a2*tp + b2*ty - b2*t*(rd - 1) - 1;

    % Euler equation: dm
    F(4) = a3*tp - a3*rm + b3*ty - b3*t*(rm - 1) + 1;

    % Pricing equation
    F(5) = exp(a0 + a2*d + a3*m + a1*z) - exp(2*a0 + 2*a2*d + 2*a3*m + 2*a1*z) + kp*(exp(z*(t - 1) + (n + t)*(b0 + b2*d + b3*m + b1*z)) - 1) - df*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z) + df*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2);

    % Pricing equation: dz
    F(6) = a1*exp(a0 + a2*d + a3*m + a1*z) - 2*a1*exp(2*a0 + 2*a2*d + 2*a3*m + 2*a1*z) + kp*exp(z*(t - 1) + (n + t)*(b0 + b2*d + b3*m + b1*z))*(t + b1*(n + t) - 1) - df*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(a1*rz - (t - 1)*(rz + b1*(rz - 1) - 1)) + df*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(2*a1*rz - (t - 1)*(rz + b1*(rz - 1) - 1));

    % pricing equation: dd
    F(7) = a2*exp(a0 + a2*d + a3*m + a1*z) - 2*a2*exp(2*a0 + 2*a2*d + 2*a3*m + 2*a1*z) + df*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(rd + 2*a2*rd - b2*(rd - 1)*(t - 1) - 1) - df*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(rd + a2*rd - b2*(rd - 1)*(t - 1) - 1) + b2*kp*exp(z*(t - 1) + (n + t)*(b0 + b2*d + b3*m + b1*z))*(n + t);

    % pricing equation: dm
    F(8) = a3*exp(a0 + a2*d + a3*m + a1*z) - 2*a3*exp(2*a0 + 2*a2*d + 2*a3*m + 2*a1*z) - df*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(a3*rm - b3*(rm - 1)*(t - 1)) + df*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(2*a3*rm - b3*(rm - 1)*(t - 1)) + b3*kp*exp(z*(t - 1) + (n + t)*(b0 + b2*d + b3*m + b1*z))*(n + t);

    %------------------------------------------------------------------------------------
    % update jacobian

    % Euler
    %J(1,1) = tp-1;
    J(1,2) = (a1 + t*(b1 + 1))*sz^2 - rz*z + tp*z;
    J(1,3) = (a2 + b2*t - 1)*sd^2   - d*rd + d*tp;
    J(1,4) = (a3 + b3)*sm^2*t^2 - m*rm + m*tp;
    %J(1,5) = ty;
    J(1,6) = t*(a1 + t*(b1 + 1))*sz^2 + ty*z - t*z*(rz - 1);
    J(1,7) = t*(a2 + b2*t - 1)*sd^2 + d*ty - d*t*(rd - 1);
    J(1,8) = (a3 + b3)*sm^2*t^2 - m*(rm - 1)*t + m*ty;

    % Euler: dz
    %J(2,1) = 0;
    %J(2,2) = tp-rz;
    %J(2,3) = 0;
    %J(2,4) = 0;
    %J(2,5) = 0;
    %J(2,6) = ty - t*(rz - 1);
    %J(2,7) = 0;
    %J(2,8) = 0;

    % Euler: dd
    %J(3,1) = 0;
    %J(3,2) = 0;
    %J(3,3) = tp-rd;
    %J(3,4) = 0;
    %J(3,5) = 0;
    %J(3,6) = 0;
    %J(3,7) = ty - t*(rd - 1);
    %J(3,8) = 0;

    % Euler: dm
    %J(4,1) = 0;
    %J(4,2) = 0;
    %J(4,3) = 0;
    %J(4,4) = tp-rm;
    %J(4,5) = 0;
    %J(4,6) = 0;
    %J(4,7) = 0;
    %J(4,8) = ty - t*(rm - 1);

    % Price
    J(5,1) = exp(a0 + a2*d + a3*m + a1*z) - 2*exp(2*a0 + 2*a2*d + 2*a3*m + 2*a1*z) - df*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z) + 2*df*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2);
    J(5,2) = z*exp(a0 + a2*d + a3*m + a1*z) - 2*z*exp(2*a0 + 2*a2*d + 2*a3*m + 2*a1*z) - (df*sz^2*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(2*a1 - 2*(b1 + 1)*(t - 1)))/2 - df*rz*z*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z) + (df*sz^2*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(8*a1 - 4*(b1 + 1)*(t - 1)))/2 + 2*df*rz*z*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2);
    J(5,3) = d*exp(a0 + a2*d + a3*m + a1*z) - 2*d*exp(2*a0 + 2*a2*d + 2*a3*m + 2*a1*z) + (df*sd^2*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(8*a2 - 4*b2*(t - 1) + 4))/2 + 2*d*df*rd*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2) - (df*sd^2*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(2*a2 - 2*b2*(t - 1) + 2))/2 - d*df*rd*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z);
    J(5,4) = m*exp(a0 + a2*d + a3*m + a1*z) - 2*m*exp(2*a0 + 2*a2*d + 2*a3*m + 2*a1*z) + df*sm^2*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2) - (df*sm^2*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z))/2 + 2*df*m*rm*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2) - df*m*rm*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z);
    J(5,5) = kp*exp(z*(t - 1) + (n + t)*(b0 + b2*d + b3*m + b1*z))*(n + t);
    J(5,6) = kp*z*exp(z*(t - 1) + (n + t)*(b0 + b2*d + b3*m + b1*z))*(n + t) + df*z*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(rz - 1)*(t - 1) - df*sz^2*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(2*a1 - (b1 + 1)*(t - 1))*(t - 1) + df*sz^2*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(a1 - (b1 + 1)*(t - 1))*(t - 1) - df*z*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(rz - 1)*(t - 1);
    J(5,7) = d*kp*exp(z*(t - 1) + (n + t)*(b0 + b2*d + b3*m + b1*z))*(n + t) + df*sd^2*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(t - 1)*(a2 - b2*(t - 1) + 1) + d*df*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(rd - 1)*(t - 1) - d*df*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(rd - 1)*(t - 1) - df*sd^2*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(t - 1)*(2*a2 - b2*(t - 1) + 1);
    J(5,8) = kp*m*exp(z*(t - 1) + (n + t)*(b0 + b2*d + b3*m + b1*z))*(n + t) - (df*sm^2*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(t - 1))/2 + (df*sm^2*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(t - 1))/2 + df*m*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(rm - 1)*(t - 1) - df*m*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(rm - 1)*(t - 1);

    % Price: dz
    J(6,1) = a1*exp(a0 + a2*d + a3*m + a1*z) - 4*a1*exp(2*a0 + 2*a2*d + 2*a3*m + 2*a1*z) - df*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(a1*rz - (t - 1)*(rz + b1*(rz - 1) - 1)) + 2*df*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(2*a1*rz - (t - 1)*(rz + b1*(rz - 1) - 1));
    J(6,2) = exp(a0 + a2*d + a3*m + a1*z) - 2*exp(2*a0 + 2*a2*d + 2*a3*m + 2*a1*z) - 4*a1*z*exp(2*a0 + 2*a2*d + 2*a3*m + 2*a1*z) + a1*z*exp(a0 + a2*d + a3*m + a1*z) + 2*df*rz*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2) - df*rz*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z) - (df*sz^2*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(2*a1 - 2*(b1 + 1)*(t - 1))*(a1*rz - (t - 1)*(rz + b1*(rz - 1) - 1)))/2 - df*rz*z*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(a1*rz - (t - 1)*(rz + b1*(rz - 1) - 1)) + (df*sz^2*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(8*a1 - 4*(b1 + 1)*(t - 1))*(2*a1*rz - (t - 1)*(rz + b1*(rz - 1) - 1)))/2 + 2*df*rz*z*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(2*a1*rz - (t - 1)*(rz + b1*(rz - 1) - 1));
    J(6,3) = a1*d*exp(a0 + a2*d + a3*m + a1*z) - 4*a1*d*exp(2*a0 + 2*a2*d + 2*a3*m + 2*a1*z) - d*df*rd*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(a1*rz - (t - 1)*(rz + b1*(rz - 1) - 1)) + (df*sd^2*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(2*a1*rz - (t - 1)*(rz + b1*(rz - 1) - 1))*(8*a2 - 4*b2*(t - 1) + 4))/2 + 2*d*df*rd*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(2*a1*rz - (t - 1)*(rz + b1*(rz - 1) - 1)) - (df*sd^2*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(a1*rz - (t - 1)*(rz + b1*(rz - 1) - 1))*(2*a2 - 2*b2*(t - 1) + 2))/2;
    J(6,4) = a1*m*exp(a0 + a2*d + a3*m + a1*z) - 4*a1*m*exp(2*a0 + 2*a2*d + 2*a3*m + 2*a1*z) - (df*sm^2*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(a1*rz - (t - 1)*(rz + b1*(rz - 1) - 1)))/2 + df*sm^2*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(2*a1*rz - (t - 1)*(rz + b1*(rz - 1) - 1)) - df*m*rm*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(a1*rz - (t - 1)*(rz + b1*(rz - 1) - 1)) + 2*df*m*rm*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(2*a1*rz - (t - 1)*(rz + b1*(rz - 1) - 1));
    J(6,5) = kp*exp(z*(t - 1) + (n + t)*(b0 + b2*d + b3*m + b1*z))*(n + t)*(t + b1*(n + t) - 1);
    J(6,6) = kp*exp(z*(t - 1) + (n + t)*(b0 + b2*d + b3*m + b1*z))*(n + t) - df*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(rz - 1)*(t - 1) + kp*z*exp(z*(t - 1) + (n + t)*(b0 + b2*d + b3*m + b1*z))*(n + t)*(t + b1*(n + t) - 1) + df*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(rz - 1)*(t - 1) + df*z*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(a1*rz - (t - 1)*(rz + b1*(rz - 1) - 1))*(rz - 1)*(t - 1) - df*sz^2*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(2*a1 - (b1 + 1)*(t - 1))*(2*a1*rz - (t - 1)*(rz + b1*(rz - 1) - 1))*(t - 1) + df*sz^2*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(a1*rz - (t - 1)*(rz + b1*(rz - 1) - 1))*(a1 - (b1 + 1)*(t - 1))*(t - 1) - df*z*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(2*a1*rz - (t - 1)*(rz + b1*(rz - 1) - 1))*(rz - 1)*(t - 1);
    J(6,7) = d*kp*exp(z*(t - 1) + (n + t)*(b0 + b2*d + b3*m + b1*z))*(n + t)*(t + b1*(n + t) - 1) - df*sd^2*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(2*a1*rz - (t - 1)*(rz + b1*(rz - 1) - 1))*(t - 1)*(2*a2 - b2*(t - 1) + 1) + df*sd^2*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(a1*rz - (t - 1)*(rz + b1*(rz - 1) - 1))*(t - 1)*(a2 - b2*(t - 1) + 1) + d*df*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(a1*rz - (t - 1)*(rz + b1*(rz - 1) - 1))*(rd - 1)*(t - 1) - d*df*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(2*a1*rz - (t - 1)*(rz + b1*(rz - 1) - 1))*(rd - 1)*(t - 1);
    J(6,8) = kp*m*exp(z*(t - 1) + (n + t)*(b0 + b2*d + b3*m + b1*z))*(n + t)*(t + b1*(n + t) - 1) - (df*sm^2*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(2*a1*rz - (t - 1)*(rz + b1*(rz - 1) - 1))*(t - 1))/2 + (df*sm^2*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(a1*rz - (t - 1)*(rz + b1*(rz - 1) - 1))*(t - 1))/2 + df*m*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(a1*rz - (t - 1)*(rz + b1*(rz - 1) - 1))*(rm - 1)*(t - 1) - df*m*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(2*a1*rz - (t - 1)*(rz + b1*(rz - 1) - 1))*(rm - 1)*(t - 1);

    % Price: dd
    J(7,1) = a2*exp(a0 + a2*d + a3*m + a1*z) - 4*a2*exp(2*a0 + 2*a2*d + 2*a3*m + 2*a1*z) + 2*df*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(rd + 2*a2*rd - b2*(rd - 1)*(t - 1) - 1) - df*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(rd + a2*rd - b2*(rd - 1)*(t - 1) - 1);
    J(7,2) = a2*z*exp(a0 + a2*d + a3*m + a1*z) - 4*a2*z*exp(2*a0 + 2*a2*d + 2*a3*m + 2*a1*z) - (df*sz^2*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(2*a1 - 2*(b1 + 1)*(t - 1))*(rd + a2*rd - b2*(rd - 1)*(t - 1) - 1))/2 - df*rz*z*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(rd + a2*rd - b2*(rd - 1)*(t - 1) - 1) + (df*sz^2*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(8*a1 - 4*(b1 + 1)*(t - 1))*(rd + 2*a2*rd - b2*(rd - 1)*(t - 1) - 1))/2 + 2*df*rz*z*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(rd + 2*a2*rd - b2*(rd - 1)*(t - 1) - 1);
    J(7,3) = exp(a0 + a2*d + a3*m + a1*z) - 2*exp(2*a0 + 2*a2*d + 2*a3*m + 2*a1*z) - 4*a2*d*exp(2*a0 + 2*a2*d + 2*a3*m + 2*a1*z) + a2*d*exp(a0 + a2*d + a3*m + a1*z) + 2*df*rd*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2) - df*rd*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z) - (df*sd^2*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(2*a2 - 2*b2*(t - 1) + 2)*(rd + a2*rd - b2*(rd - 1)*(t - 1) - 1))/2 - d*df*rd*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(rd + a2*rd - b2*(rd - 1)*(t - 1) - 1) + (df*sd^2*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(8*a2 - 4*b2*(t - 1) + 4)*(rd + 2*a2*rd - b2*(rd - 1)*(t - 1) - 1))/2 + 2*d*df*rd*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(rd + 2*a2*rd - b2*(rd - 1)*(t - 1) - 1);
    J(7,4) = a2*m*exp(a0 + a2*d + a3*m + a1*z) - 4*a2*m*exp(2*a0 + 2*a2*d + 2*a3*m + 2*a1*z) - (df*sm^2*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(rd + a2*rd - b2*(rd - 1)*(t - 1) - 1))/2 + df*sm^2*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(rd + 2*a2*rd - b2*(rd - 1)*(t - 1) - 1) - df*m*rm*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(rd + a2*rd - b2*(rd - 1)*(t - 1) - 1) + 2*df*m*rm*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(rd + 2*a2*rd - b2*(rd - 1)*(t - 1) - 1);
    J(7,5) = b2*kp*exp(z*(t - 1) + (n + t)*(b0 + b2*d + b3*m + b1*z))*(n + t)^2;
    J(7,6) = b2*kp*z*exp(z*(t - 1) + (n + t)*(b0 + b2*d + b3*m + b1*z))*(n + t)^2 - df*z*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(rz - 1)*(t - 1)*(rd + 2*a2*rd - b2*(rd - 1)*(t - 1) - 1) + df*z*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(rz - 1)*(t - 1)*(rd + a2*rd - b2*(rd - 1)*(t - 1) - 1) - df*sz^2*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(2*a1 - (b1 + 1)*(t - 1))*(t - 1)*(rd + 2*a2*rd - b2*(rd - 1)*(t - 1) - 1) + df*sz^2*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(a1 - (b1 + 1)*(t - 1))*(t - 1)*(rd + a2*rd - b2*(rd - 1)*(t - 1) - 1);
    J(7,7) = kp*exp(z*(t - 1) + (n + t)*(b0 + b2*d + b3*m + b1*z))*(n + t) - df*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(rd - 1)*(t - 1) + b2*d*kp*exp(z*(t - 1) + (n + t)*(b0 + b2*d + b3*m + b1*z))*(n + t)^2 + df*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(rd - 1)*(t - 1) - d*df*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(rd - 1)*(t - 1)*(rd + 2*a2*rd - b2*(rd - 1)*(t - 1) - 1) - df*sd^2*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(t - 1)*(2*a2 - b2*(t - 1) + 1)*(rd + 2*a2*rd - b2*(rd - 1)*(t - 1) - 1) + df*sd^2*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(t - 1)*(a2 - b2*(t - 1) + 1)*(rd + a2*rd - b2*(rd - 1)*(t - 1) - 1) + d*df*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(rd - 1)*(t - 1)*(rd + a2*rd - b2*(rd - 1)*(t - 1) - 1);
    J(7,8) = b2*kp*m*exp(z*(t - 1) + (n + t)*(b0 + b2*d + b3*m + b1*z))*(n + t)^2 + (df*sm^2*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(t - 1)*(rd + a2*rd - b2*(rd - 1)*(t - 1) - 1))/2 - (df*sm^2*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(t - 1)*(rd + 2*a2*rd - b2*(rd - 1)*(t - 1) - 1))/2 - df*m*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(rm - 1)*(t - 1)*(rd + 2*a2*rd - b2*(rd - 1)*(t - 1) - 1) + df*m*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(rm - 1)*(t - 1)*(rd + a2*rd - b2*(rd - 1)*(t - 1) - 1);

    % Price: dm
    J(8,1) = a3*exp(a0 + a2*d + a3*m + a1*z) - 4*a3*exp(2*a0 + 2*a2*d + 2*a3*m + 2*a1*z) - df*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(a3*rm - b3*(rm - 1)*(t - 1)) + 2*df*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(2*a3*rm - b3*(rm - 1)*(t - 1));
    J(8,2) = a3*z*exp(a0 + a2*d + a3*m + a1*z) - 4*a3*z*exp(2*a0 + 2*a2*d + 2*a3*m + 2*a1*z) - df*rz*z*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(a3*rm - b3*(rm - 1)*(t - 1)) + (df*sz^2*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(8*a1 - 4*(b1 + 1)*(t - 1))*(2*a3*rm - b3*(rm - 1)*(t - 1)))/2 + 2*df*rz*z*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(2*a3*rm - b3*(rm - 1)*(t - 1)) - (df*sz^2*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(2*a1 - 2*(b1 + 1)*(t - 1))*(a3*rm - b3*(rm - 1)*(t - 1)))/2;
    J(8,3) = a3*d*exp(a0 + a2*d + a3*m + a1*z) - 4*a3*d*exp(2*a0 + 2*a2*d + 2*a3*m + 2*a1*z) + (df*sd^2*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(2*a3*rm - b3*(rm - 1)*(t - 1))*(8*a2 - 4*b2*(t - 1) + 4))/2 + 2*d*df*rd*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(2*a3*rm - b3*(rm - 1)*(t - 1)) - (df*sd^2*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(a3*rm - b3*(rm - 1)*(t - 1))*(2*a2 - 2*b2*(t - 1) + 2))/2 - d*df*rd*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(a3*rm - b3*(rm - 1)*(t - 1));
    J(8,4) = exp(a0 + a2*d + a3*m + a1*z) - 2*exp(2*a0 + 2*a2*d + 2*a3*m + 2*a1*z) - 4*a3*m*exp(2*a0 + 2*a2*d + 2*a3*m + 2*a1*z) + a3*m*exp(a0 + a2*d + a3*m + a1*z) + 2*df*rm*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2) - df*rm*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z) + df*sm^2*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(2*a3*rm - b3*(rm - 1)*(t - 1)) - (df*sm^2*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(a3*rm - b3*(rm - 1)*(t - 1)))/2 + 2*df*m*rm*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(2*a3*rm - b3*(rm - 1)*(t - 1)) - df*m*rm*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(a3*rm - b3*(rm - 1)*(t - 1));
    J(8,5) = b3*kp*exp(z*(t - 1) + (n + t)*(b0 + b2*d + b3*m + b1*z))*(n + t)^2;
    J(8,6) = b3*kp*z*exp(z*(t - 1) + (n + t)*(b0 + b2*d + b3*m + b1*z))*(n + t)^2 + df*z*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(rz - 1)*(t - 1)*(a3*rm - b3*(rm - 1)*(t - 1)) - df*sz^2*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(2*a1 - (b1 + 1)*(t - 1))*(t - 1)*(2*a3*rm - b3*(rm - 1)*(t - 1)) + df*sz^2*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(a1 - (b1 + 1)*(t - 1))*(t - 1)*(a3*rm - b3*(rm - 1)*(t - 1)) - df*z*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(rz - 1)*(t - 1)*(2*a3*rm - b3*(rm - 1)*(t - 1));
    J(8,7) = b3*d*kp*exp(z*(t - 1) + (n + t)*(b0 + b2*d + b3*m + b1*z))*(n + t)^2 + df*sd^2*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(t - 1)*(a3*rm - b3*(rm - 1)*(t - 1))*(a2 - b2*(t - 1) + 1) + d*df*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(rd - 1)*(t - 1)*(a3*rm - b3*(rm - 1)*(t - 1)) - d*df*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(rd - 1)*(t - 1)*(2*a3*rm - b3*(rm - 1)*(t - 1)) - df*sd^2*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(t - 1)*(2*a3*rm - b3*(rm - 1)*(t - 1))*(2*a2 - b2*(t - 1) + 1);
    J(8,8) = kp*exp(z*(t - 1) + (n + t)*(b0 + b2*d + b3*m + b1*z))*(n + t) - df*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(rm - 1)*(t - 1) + b3*kp*m*exp(z*(t - 1) + (n + t)*(b0 + b2*d + b3*m + b1*z))*(n + t)^2 + df*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(rm - 1)*(t - 1) - (df*sm^2*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(t - 1)*(2*a3*rm - b3*(rm - 1)*(t - 1)))/2 + (df*sm^2*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(t - 1)*(a3*rm - b3*(rm - 1)*(t - 1)))/2 + df*m*exp((sz^2*(a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(a3 - b3*(t - 1)))/2 + (sd^2*(a2 - b2*(t - 1) + 1)^2)/2)*exp(a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + a2*d*rd + a3*m*rm + a1*rz*z)*(rm - 1)*(t - 1)*(a3*rm - b3*(rm - 1)*(t - 1)) - df*m*exp(2*a0 - (t - 1)*(z*(rz - 1) + b3*m*(rm - 1) + b1*z*(rz - 1) + b2*d*(rd - 1)) + d*(rd - 1) + 2*a2*d*rd + 2*a3*m*rm + 2*a1*rz*z)*exp((sd^2*(2*a2 - b2*(t - 1) + 1)^2)/2 + (sz^2*(2*a1 - (b1 + 1)*(t - 1))^2)/2 + (sm^2*(2*a3 - b3*(t - 1)))/2)*(rm - 1)*(t - 1)*(2*a3*rm - b3*(rm - 1)*(t - 1));

end

%fprintf('Count %4.2f \n', count);

% Output
par = Bp;

end